<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run the analysis • DENVfoiMap</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Run the analysis">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DENVfoiMap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/how_to_run_analysis.html">Run the analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lorecatta/DENVfoiMap">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Run the analysis</h1>
            
      
      
      <div class="hidden name"><code>how_to_run_analysis.Rmd</code></div>

    </div>

    
    
<p>We first load the package</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(DENVfoiMap)</code></pre></div>
<p>We then need to download the database of global disaggregated FOI and environmental and demographic covariates values at 1/6 decimal degree resolution. This is a data frame with 425138 rows and 43 columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_url &lt;-<span class="st"> "https://mrcdata.dide.ic.ac.uk/resources/DENVfoiMap/all_squares_env_var_0_1667_deg.rds"</span>

all_sqr_covariates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readRDS">readRDS</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(my_url))</code></pre></div>
<p>We define some parameters</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">extra_prms &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">id_fld =</span> <span class="st">"unique_id"</span>,
                   <span class="dt">grp_flds =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"unique_id"</span>, <span class="st">"ID_0"</span>, <span class="st">"ID_1"</span>),
                   <span class="dt">ranger_threads =</span> <span class="ot">NULL</span>,
                   <span class="dt">fit_type =</span> <span class="st">"boot"</span>,
                   <span class="dt">parallel_2 =</span> <span class="ot">FALSE</span>,
                   <span class="dt">screening_ages =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">9</span>, <span class="dv">16</span>),
                   <span class="dt">target_nm =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"I"</span>, <span class="st">"C"</span>, <span class="st">"HC"</span>, <span class="st">"R0_1"</span>, <span class="st">"R0_2"</span>),
                   <span class="dt">coord_limits =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">74</span>, <span class="op">-</span><span class="dv">32</span>, <span class="op">-</span><span class="dv">34</span>, <span class="dv">6</span>))

my_col &lt;-<span class="st"> </span>colorRamps<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/colorRamps/topics/matlab.like">matlab.like</a></span>(<span class="dv">100</span>)</code></pre></div>
<p>and variables which depend on those parameters</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">parameters &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_parameter_list.html">create_parameter_list</a></span>(<span class="dt">extra_params =</span> extra_prms)

all_wgt &lt;-<span class="st"> </span>parameters<span class="op">$</span>all_wgt

all_predictors &lt;-<span class="st"> </span>predictor_rank<span class="op">$</span>name

base_info &lt;-<span class="st"> </span>parameters<span class="op">$</span>base_info

foi_offset &lt;-<span class="st"> </span>parameters<span class="op">$</span>foi_offset

coord_limits &lt;-<span class="st"> </span>parameters<span class="op">$</span>coord_limits

screening_ages &lt;-<span class="st"> </span>parameters<span class="op">$</span>screening_ages</code></pre></div>
<p>Now we do some preprocessing</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">foi_data<span class="op">$</span>new_weight &lt;-<span class="st"> </span>all_wgt

pAbs_wgt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_sat_area_wgts.html">get_sat_area_wgts</a></span>(foi_data, parameters)

foi_data[foi_data<span class="op">$</span>type <span class="op">==</span><span class="st"> "pseudoAbsence"</span>, <span class="st">"new_weight"</span>] &lt;-<span class="st"> </span>pAbs_wgt</code></pre></div>
<p>We create one bootstrap sample of the data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">foi_data_all_bsamples &lt;-<span class="st"> </span><span class="kw"><a href="../reference/grid_and_boot.html">grid_and_boot</a></span>(<span class="dt">data_df =</span> foi_data, <span class="dt">parms =</span> parameters)

foi_data_bsample_full &lt;-<span class="st"> </span>foi_data_all_bsamples[[<span class="dv">1</span>]]

psab_all_idx &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(foi_data_bsample_full<span class="op">$</span>type <span class="op">==</span><span class="st"> "pseudoAbsence"</span>)
cases_all_idx &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(foi_data_bsample_full<span class="op">$</span>type <span class="op">==</span><span class="st"> "caseReport"</span>)
sero_all_idx &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(foi_data_bsample_full<span class="op">$</span>type <span class="op">==</span><span class="st"> "serology"</span>)
psab_idx &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(psab_all_idx, <span class="dv">2</span>)
cases_idx &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(cases_all_idx, <span class="dv">2</span>)
sero_idx &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(sero_all_idx, <span class="dv">2</span>)
foi_data_bsample &lt;-<span class="st"> </span>foi_data_bsample_full[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(psab_idx, cases_idx, sero_idx),]
foi_data_bsample<span class="op">$</span>unique_id &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_len</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(foi_data_bsample))</code></pre></div>
<p>We then fit the random forest model. This takes approximately 20-30 minutes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RF_obj_optim &lt;-<span class="st"> </span><span class="kw"><a href="../reference/full_routine_bootstrap.html">full_routine_bootstrap</a></span>(<span class="dt">parms =</span> parameters,
                                       <span class="dt">original_foi_data =</span> foi_data,
                                       <span class="dt">adm_covariates =</span> admin_covariates,
                                       <span class="dt">all_squares =</span> all_sqr_covariates,
                                       <span class="dt">covariates_names =</span> all_predictors,
                                       <span class="dt">boot_sample =</span> foi_data_bsample)</code></pre></div>
<p>We can make force of infection predictions using a dataset of covariates. In this example we will do it for Brazil only to reduce computing time</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BRA_ID_<span class="dv">0</span> &lt;-<span class="st"> </span><span class="dv">33</span>

BRA_sqr_covariates &lt;-<span class="st"> </span>all_sqr_covariates[all_sqr_covariates<span class="op">$</span>ID_<span class="dv">0</span> <span class="op">==</span><span class="st"> </span>BRA_ID_<span class="dv">0</span>,]

BRA_predictions &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make_ranger_predictions.html">make_ranger_predictions</a></span>(RF_obj_optim,
                                           <span class="dt">dataset =</span> BRA_sqr_covariates,
                                           <span class="dt">covariates_names =</span> all_predictors)

BRA_predictions &lt;-<span class="st"> </span>BRA_predictions <span class="op">-</span><span class="st"> </span>foi_offset
BRA_predictions[BRA_predictions <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="dv">0</span>

BRA_sqr_covariates<span class="op">$</span>p_i &lt;-<span class="st"> </span>BRA_predictions</code></pre></div>
<p>And now we make a map of predicted force of infection for Brazil</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># map</span>
map_data_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/map_preprocess.html">map_preprocess</a></span>(BRA_sqr_covariates, <span class="st">"p_i"</span>, parameters)
q_map &lt;-<span class="st"> </span><span class="kw"><a href="../reference/quick_raster_map.html">quick_raster_map</a></span>(<span class="dt">countries =</span> Brazil_contour,
                          <span class="dt">pred_df =</span> map_data_df,
                          <span class="dt">my_col =</span> my_col,
                          <span class="dt">ttl =</span> <span class="st">"FOI"</span>,
                          <span class="dt">parms =</span> parameters)
q_map</code></pre></div>
<div class="figure">
<img src="how_to_run_analysis_files/figure-html/foi%20map-1.png" alt="Predicted dengue force of infection for Brazil" width="480"><p class="caption">
Predicted dengue force of infection for Brazil
</p>
</div>
<p><br></p>
<p>We can now calculate the dengue reproduction number, <span class="math inline">\(R_{0}\)</span>, corresponding to the predicted force of infections, and the burden estimates. We can use the <a href="https://github.com/mrc-ide/drep">drep</a> package for this.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># preprocessing</span>
age_band_tgs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="st">"band"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(age_structure), <span class="dt">value =</span> <span class="ot">TRUE</span>)
age_band_bnds &lt;-<span class="st"> </span>drep<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/drep/topics/get_age_band_bounds">get_age_band_bounds</a></span>(age_band_tgs)
age_band_L_bounds &lt;-<span class="st"> </span>age_band_bnds[, <span class="dv">1</span>]
age_band_U_bounds &lt;-<span class="st"> </span>age_band_bnds[, <span class="dv">2</span>]

<span class="co"># create lookup tables - this takes 5-10 minutes</span>
lookup_tabs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_lookup_tables.html">create_lookup_tables</a></span>(
  <span class="dt">age_struct =</span> age_structure,
  <span class="dt">age_band_tags =</span> age_band_tgs,
  <span class="dt">age_band_L_bounds =</span> age_band_L_bounds,
  <span class="dt">age_band_U_bounds =</span> age_band_U_bounds,
  <span class="dt">parms =</span> parameters)

<span class="co"># assume a transmission reduction effect of 0% (scale factor = 1)</span>
sf_val &lt;-<span class="st"> </span>parameters<span class="op">$</span>sf_vals[<span class="dv">1</span>]

<span class="co"># attach look up table id</span>
sqr_preds_<span class="dv">2</span> &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(age_structure[, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"age_id"</span>, <span class="st">"ID_0"</span>)],
                                 BRA_sqr_covariates,
                                 <span class="dt">by =</span> <span class="st">"ID_0"</span>)

sqr_preds_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">as.matrix</a></span>(sqr_preds_<span class="dv">2</span>)

burden_estimates_raw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/wrapper_to_replicate_R0_and_burden.html">wrapper_to_replicate_R0_and_burden</a></span>(
  <span class="dt">foi_data =</span> sqr_preds_<span class="dv">3</span>,
  <span class="dt">scaling_factor =</span> sf_val,
  <span class="dt">FOI_to_Inf_list =</span> lookup_tabs[[<span class="dv">1</span>]],
  <span class="dt">FOI_to_C_list =</span> lookup_tabs[[<span class="dv">2</span>]],
  <span class="dt">FOI_to_HC_list =</span> lookup_tabs[[<span class="dv">3</span>]],
  <span class="dt">FOI_to_R0_1_list =</span> lookup_tabs[[<span class="dv">4</span>]],
  <span class="dt">FOI_to_R0_2_list =</span> lookup_tabs[[<span class="dv">5</span>]],
  <span class="dt">parms =</span> parameters)

burden_estimates &lt;-<span class="st"> </span><span class="kw"><a href="../reference/post_processing_burden.html">post_processing_burden</a></span>(sqr_preds_<span class="dv">3</span>, burden_estimates_raw, parameters)</code></pre></div>
<p>We can map one <span class="math inline">\(R_{0}\)</span>, for instance the one for assumption 1, only primary and secondary infections are infectious</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_data_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/map_preprocess.html">map_preprocess</a></span>(burden_estimates, <span class="st">"transformed_1"</span>, parameters)
r0_map_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/quick_raster_map.html">quick_raster_map</a></span>(<span class="dt">countries =</span> Brazil_contour,
                             <span class="dt">pred_df =</span> map_data_df,
                             <span class="dt">my_col =</span> my_col,
                             <span class="dt">ttl =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/expression">expression</a></span>(<span class="st">"R"</span>[<span class="dv">0</span>]),
                             <span class="dt">parms =</span> parameters)
r0_map_<span class="dv">1</span></code></pre></div>
<div class="figure">
<img src="how_to_run_analysis_files/figure-html/R0_1%20map-1.png" alt="Predicted dengue reproduction number for Brazil (assumption 1)" width="480"><p class="caption">
Predicted dengue reproduction number for Brazil (assumption 1)
</p>
</div>
<p><br></p>
<p>Or the <span class="math inline">\(R_{0}\)</span> for assumption 2, all infections (primary to quaternary) are infectious</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_data_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/map_preprocess.html">map_preprocess</a></span>(burden_estimates, <span class="st">"transformed_2"</span>, parameters)
r0_map_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/quick_raster_map.html">quick_raster_map</a></span>(<span class="dt">countries =</span> Brazil_contour,
                             <span class="dt">pred_df =</span> map_data_df,
                             <span class="dt">my_col =</span> my_col,
                             <span class="dt">ttl =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/expression">expression</a></span>(<span class="st">"R"</span>[<span class="dv">0</span>]),
                             <span class="dt">parms =</span> parameters)
r0_map_<span class="dv">2</span></code></pre></div>
<div class="figure">
<img src="how_to_run_analysis_files/figure-html/R0_2%20map-1.png" alt="Predicted dengue reproduction number for Brazil (assumption 2)" width="480"><p class="caption">
Predicted dengue reproduction number for Brazil (assumption 2)
</p>
</div>
<p><br></p>
<p>We can also map a burden measure, e.g. the incidence of annual infections (per 1000)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">burden_estimates<span class="op">$</span>I_num_inc &lt;-<span class="st"> </span>burden_estimates<span class="op">$</span>I_num <span class="op">/</span><span class="st"> </span>burden_estimates<span class="op">$</span>population <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>

map_data_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/map_preprocess.html">map_preprocess</a></span>(burden_estimates, <span class="st">"I_num_inc"</span>, parameters)
inc_inf_map &lt;-<span class="st"> </span><span class="kw"><a href="../reference/quick_raster_map.html">quick_raster_map</a></span>(<span class="dt">countries =</span> Brazil_contour,
                                <span class="dt">pred_df =</span> map_data_df,
                                <span class="dt">my_col =</span> my_col,
                                <span class="dt">ttl =</span> <span class="st">"Infections"</span>,
                                <span class="dt">parms =</span> parameters)
inc_inf_map</code></pre></div>
<div class="figure">
<img src="how_to_run_analysis_files/figure-html/infections%20incidence%20map-1.png" alt="Predicted incidence of annual dengue infections for Brazil" width="480"><p class="caption">
Predicted incidence of annual dengue infections for Brazil
</p>
</div>
<p><br></p>
<p>We now estimate the impact of control strategies using the predicted <span class="math inline">\(R_{0}\)</span>. We first look at a transmission-reduction type of intervention, such as <em>Wolbachia</em>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># assume a transmission reduction effect of 30%</span>
sf_val &lt;-<span class="st"> </span>parameters<span class="op">$</span>sf_vals[<span class="dv">4</span>]

tr_red_impact_estimates_raw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/wrapper_to_replicate_R0_and_burden.html">wrapper_to_replicate_R0_and_burden</a></span>(
  <span class="dt">foi_data =</span> sqr_preds_<span class="dv">3</span>,
  <span class="dt">scaling_factor =</span> sf_val,
  <span class="dt">FOI_to_Inf_list =</span> lookup_tabs[[<span class="dv">1</span>]],
  <span class="dt">FOI_to_C_list =</span> lookup_tabs[[<span class="dv">2</span>]],
  <span class="dt">FOI_to_HC_list =</span> lookup_tabs[[<span class="dv">3</span>]],
  <span class="dt">FOI_to_R0_1_list =</span> lookup_tabs[[<span class="dv">4</span>]],
  <span class="dt">FOI_to_R0_2_list =</span> lookup_tabs[[<span class="dv">5</span>]],
  <span class="dt">parms =</span> parameters)

tr_red_impact_estimates &lt;-<span class="st"> </span><span class="kw"><a href="../reference/post_processing_burden.html">post_processing_burden</a></span>(sqr_preds_<span class="dv">3</span>, tr_red_impact_estimates_raw, parameters)</code></pre></div>
<p>And then map the incidence of infections following the intervention (for <span class="math inline">\(R_{0}\)</span> assumption 1)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr_red_impact_estimates<span class="op">$</span>I_num_1_inc &lt;-<span class="st"> </span>tr_red_impact_estimates<span class="op">$</span>I_num_<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>tr_red_impact_estimates<span class="op">$</span>population <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>
mp_nm &lt;-<span class="st"> "Infections_30pc_tr_red_impact.png"</span>
map_data_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/map_preprocess.html">map_preprocess</a></span>(tr_red_impact_estimates, <span class="st">"I_num_1_inc"</span>, parameters)
inc_inf_map_30pc_tr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/quick_raster_map.html">quick_raster_map</a></span>(<span class="dt">countries =</span> Brazil_contour,
                                        <span class="dt">pred_df =</span> map_data_df,
                                        <span class="dt">my_col =</span> my_col,
                                        <span class="dt">ttl =</span> <span class="st">"Infections"</span>,
                                        <span class="dt">parms =</span> parameters)
inc_inf_map_30pc_tr</code></pre></div>
<div class="figure">
<img src="how_to_run_analysis_files/figure-html/intervention_1%20map-1.png" alt="Predicted incidence of annual dengue infections for Brazil following application of an intervention with 30% transmission reduction effect" width="480"><p class="caption">
Predicted incidence of annual dengue infections for Brazil following application of an intervention with 30% transmission reduction effect
</p>
</div>
<p><br></p>
<p>Finally, we predict the impact of the Sanofi-Pasteur dengue vaccine using estimates of the vaccine effect size from this <a href="https://science.sciencemag.org/content/353/6303/1033">study</a> and our <span class="math inline">\(R_{0}\)</span> predictions (assumption 1 in this example)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">R0_1_preds &lt;-<span class="st"> </span>burden_estimates<span class="op">$</span>transformed_<span class="dv">1</span>

my_look_up_table &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pre_process_vaccine_lookup_table.html">pre_process_vaccine_lookup_table</a></span>(R0_to_prop_infections_averted_lookup_<span class="dv">1</span>, R0_1_preds)

screen_age &lt;-<span class="st"> </span>screening_ages[<span class="dv">1</span>] <span class="co"># 9 years olds</span>

prop_averted &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/approxfun">approx</a></span>(my_look_up_table[, <span class="st">"R0"</span>], my_look_up_table[, screen_age], <span class="dt">xout =</span> R0_1_preds)<span class="op">$</span>y

burden_net_vaccine &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>prop_averted) <span class="op">*</span><span class="st"> </span>burden_estimates[, <span class="st">"I_num"</span>]

burden_estimates_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(burden_estimates[, base_info], <span class="dt">I_vacc_impact =</span> burden_net_vaccine)</code></pre></div>
<p>We map incidence of infections following vaccination</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">burden_estimates_<span class="dv">2</span><span class="op">$</span>I_num_1_inc_v &lt;-<span class="st"> </span>burden_estimates_<span class="dv">2</span><span class="op">$</span>I_vacc_impact <span class="op">/</span><span class="st"> </span>burden_estimates_<span class="dv">2</span><span class="op">$</span>population <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>

map_data_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/map_preprocess.html">map_preprocess</a></span>(burden_estimates_<span class="dv">2</span>, <span class="st">"I_num_1_inc_v"</span>, parameters)
inc_inf_map_vacc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/quick_raster_map.html">quick_raster_map</a></span>(<span class="dt">countries =</span> Brazil_contour,
                                     <span class="dt">pred_df =</span> map_data_df,
                                     <span class="dt">my_col =</span> my_col,
                                     <span class="dt">ttl =</span> <span class="st">"Infections"</span>,
                                     <span class="dt">parms =</span> parameters)
inc_inf_map_vacc</code></pre></div>
<div class="figure">
<img src="how_to_run_analysis_files/figure-html/intervention_2%20map-1.png" alt="Predicted incidence of annual dengue infections for Brazil following vaccination of 9 years olds  (80% vaccine coverage)" width="480"><p class="caption">
Predicted incidence of annual dengue infections for Brazil following vaccination of 9 years olds (80% vaccine coverage)
</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Lorenzo Cattarino.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
